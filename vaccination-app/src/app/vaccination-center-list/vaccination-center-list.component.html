<div class="container">
  <!-- Loading state -->
  <div *ngIf="isLoading" class="loading">
    Chargement des centres...
  </div>

  <!-- Error state -->
  <div *ngIf="error" class="error">
    {{ error }}
  </div>

  <!-- Main content when data is loaded -->
  <ng-container *ngIf="!isLoading && !error">
    <!-- Barre de recherche -->
    <div class="search-bar">
      <input
        type="text"
        placeholder="Rechercher un centre..."
        [(ngModel)]="searchTerm"
        (input)="filterCenters()"
      />
    </div>

    <!-- Message if no centers -->
    <div *ngIf="centers.length === 0" class="no-results">
      Aucun centre disponible
    </div>

    <!-- Liste des résultats -->
    <div class="results" *ngIf="filteredCenters.length > 0">
      <button *ngFor="let center of filteredCenters" (click)="select(center)">
        {{ center.name }} - {{ center.address }}, {{ center.city }}
      </button>
    </div>

    <!-- Centre sélectionné -->
    <div *ngIf="selectedCenter" class="selected-center">
      <h3>Centre sélectionné :</h3>
      <p><strong>Nom :</strong> {{ selectedCenter.name }}</p>
      <p><strong>Adresse :</strong> {{ selectedCenter.address }}</p>
      <p><strong>Ville :</strong> {{ selectedCenter.city }}</p>
      <p><strong>Email :</strong> {{ selectedCenter.email }}</p>
      <p><strong>Téléphone :</strong> {{ selectedCenter.phone }}</p>

      <!-- Loading state for doctors -->
      <div *ngIf="isDoctorsLoading" class="loading">
        Chargement des médecins...
      </div>

      <!-- Error state for doctors -->
      <div *ngIf="doctorsError" class="error">
        {{ doctorsError }}
      </div>

      <!-- Sélection du médecin -->
      <mat-form-field appearance="fill" *ngIf="!isDoctorsLoading && !doctorsError && selectedDoctors.length > 0">
        <mat-label>Choisissez un médecin</mat-label>
        <mat-select [(ngModel)]="selectedDoctor">
          <mat-option *ngFor="let doctor of selectedDoctors" [value]="doctor">
            {{ doctor.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Message if no doctors available -->
      <p *ngIf="!isDoctorsLoading && !doctorsError && selectedDoctors.length === 0" class="no-results">
        Aucun médecin disponible pour ce centre
      </p>

      <!-- Sélection de la date -->
      <mat-form-field>
        <mat-label>Choisir une date</mat-label>
        <input matInput [matDatepicker]="picker" [(ngModel)]="selectedDate" />
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <!-- Résumé du choix -->
      <p *ngIf="selectedCenter && selectedDoctor && selectedDate">
        Vous avez choisi le centre <strong>{{ selectedCenter.name }}</strong> avec le médecin 
        <strong>{{ selectedDoctor.name }}</strong> à la date du 
        <strong>{{ selectedDate | date: 'longDate' }}</strong>.
      </p>

      <!-- État de création de la réservation -->
      <div *ngIf="isCreatingReservation" class="loading">
        Création de la réservation en cours...
      </div>

      <!-- Bouton de validation -->
      <button mat-raised-button 
              color="primary" 
              (click)="validateAppointment()"
              [disabled]="isCreatingReservation">
        Valider
      </button>

      <!-- Affichage du message après validation -->
      <p *ngIf="appointmentConfirmed" style="color: green; font-weight: bold; margin-top: 10px;">
        Rendez-vous pris !
      </p>
    </div>
  </ng-container>
</div>
